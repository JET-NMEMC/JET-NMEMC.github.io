<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        .my-div-icon {
            font-size: 15px;
            color: red;
        }
    </style>
</head>

<body>
    <div id="mapid" style="width: 1000px; height: 800px;"></div>
    <script>
        var map = L.map('mapid').setView([37, 120], 7);

        // L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
        //     maxZoom: 18,
        //     attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
        //         'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
        //     id: 'mapbox/streets-v11',
        //     tileSize: 512,
        //     zoomOffset: -1
        // }).addTo(mymap);

        L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}", {
            maxZoom: 17,
            // zoomOffset: -1
        }).addTo(map);


        var rigon_name = '营口市西市区';
        var rigon_osm_id;
        var xiaji = "是";
        $.ajax({
            url: "https://nominatim.openstreetmap.org/search.php?q=" + rigon_name + "&osmtype=R&polygon_geojson=1&format=jsonv2",
            // data: { age: 20, sex: 'man' },
            async: false,
            dataType: 'json',
            success: function (result) {
                console.log("搜索结果："+result[0].display_name);
                rigon_osm_id = result[0].osm_id;
                map.fitBounds(L.geoJSON(result[0].geojson).getBounds());
                if (xiaji != "是") {
                    L.geoJSON(result[0].geojson).addTo(map);
                }
            }
        });
        console.log(rigon_osm_id);

        if (xiaji != "是") { }
        else {

            var aSearch;
            $.ajax({
                url: "https://www.openstreetmap.org/api/0.6/relation/" + rigon_osm_id + "/full",
                // data: { age: 20, sex: 'man' },
                async: false,
                dataType: 'json',
                success: function (result) {
                    aSearch = result.elements.filter(function (i) {
                        return i.type.includes('relation');
                    });
                }
            });
            console.log(aSearch);

            for (var i = 0; i < aSearch.length; i++) {
                var rigon_id = aSearch[i].id;
                if (rigon_id == rigon_osm_id) {
                    continue
                } else {
                    $.ajax({
                        url: "https://nominatim.openstreetmap.org/details.php?osmtype=R&osmid=" + rigon_id + "&class=boundary&addressdetails=1&hierarchy=0&group_hierarchy=0&polygon_geojson=1&format=json",
                        async: false,
                        dataType: 'json',
                        success: function (result) {
                            console.log(result.localname, result.osm_id);
                            L.geoJSON(result.geometry).bindPopup(result.localname).addTo(map);
                            let markerIcon = L.divIcon({
                                html: result.localname,//marker标注
                                className: 'my-div-icon',
                                // iconSize: 30,
                                iconAnchor: [0, 0]//文字标注相对位置
                            });
                            L.marker([result.centroid.coordinates[1], result.centroid.coordinates[0]], { icon: markerIcon }).addTo(map);
                        }
                    })
                }
            }

        }


    </script>

</body>

</html>